const jwt = require("jsonwebtoken");
const User = require("../models/user");
const bcrypt = require("bcrypt");
const Credential = require("../models/credential");
const Session = require("../models/session");
const { DateTime } = require("luxon");
const nodemailer = require("nodemailer");

module.exports = {
  registerUser: async (req, res) => {
    const { fullName, email, password } = req.body;

    try {
      // Create User In DataBase
      const user = await User.create({
        fullName,
        email,
        role: "user",
      });

      // Encrypt Password And Store In DataBase
      const encryptedPassword = await bcrypt.hash(password, 10);
      await Credential.create({
        userId: user._id,
        password: encryptedPassword,
      });

      // Generate Jwt Token And Store In DataBase
      const tokenObj = {
        _id: user._id,
        fullName: user.fullName,
        email: user.email,
      };
      const expireTime = 15 * 24 * 60 * 60;
      const jwtToken = jwt.sign(tokenObj, process.env.JWT_SECRET_KEY, {
        expiresIn: expireTime,
      });
      await Session.create({
        userId: user._id,
        token: jwtToken,
        status: "current",
        loginAt: DateTime.utc(),
        expireAt: DateTime.utc().plus({ hours: 3 }),
      });

      res.cookie("x-session-token", jwtToken, {
        httpOnly: true,
        secure: true,
        maxAge: 15 * 24 * 60 * 60 * 1000,
        path: "/",
      });

      return res.status(201).json({
        user,
        token: jwtToken,
      });
    } catch (error) {
      return res.status(500).json({
        message: "Internal Server Error",
        error: error,
      });
    }
  },

  loginUser: async (req, res) => {
    const { email, password } = req.body;

    try {
      // Find user is exist or not
      const user = await User.findOne({ email: email }).lean();
      if (!user) {
        return res.status(404).json({
          message: "User not found. Please try again with different email.",
        });
      }

      // Get password and check is correct or not
      const credential = await Credential.findOne({ userId: user._id });
      const checkPassword = await bcrypt.compare(password, credential.password);
      if (!checkPassword) {
        return res.status(401).json({
          message: "Invalid Password.",
        });
      }

      // Generate Jwt Token And Update In Session DataBase
      const tokenObj = {
        _id: user._id,
        fullName: user.fullName,
        email: user.email,
      };
      const expireTime = 15 * 24 * 60 * 60;
      const jwtToken = jwt.sign(tokenObj, process.env.JWT_SECRET_KEY, {
        expiresIn: expireTime,
      });
      await Session.findOneAndUpdate(
        { userId: user._id },
        {
          userId: user._id,
          token: jwtToken,
          status: "current",
          loginAt: DateTime.utc(),
          expireAt: DateTime.utc().plus({ hours: 3 }),
        }
      );

      res.cookie("x-session-token", jwtToken, {
        httpOnly: true,
        secure: true,
        maxAge: 15 * 24 * 60 * 60 * 1000,
        path: "/",
      });

      return res.status(200).json({
        user,
        token: jwtToken,
      });
    } catch (error) {
      return res.status(500).json({
        message: "Internal Server Error",
        error,
      });
    }
  },

  checkWhoIs: (req, res) => {
    const { loggedInUserData } = req;
    res.status(200).json({
      user: loggedInUserData["user"],
      session: loggedInUserData["session"],
    });
  },

  logOutUser: async (req, res) => {
    const { sessionId } = req.body;

    if (!sessionId) {
      return res.status(400).json({
        message: "sessionId Required",
      });
    }

    try {
      const getSession = await Session.findById(sessionId);

      if (!getSession) {
        return res.status(404).json({
          message: "sessionId not found",
        });
      }

      if (getSession.status == "expired") {
        return res.status(200).json({
          message: "Token Already Expired",
        });
      }

      await Session.findByIdAndUpdate(
        sessionId,
        { status: "expired" },
        { new: true }
      );

      return res.status(200).json({
        message: "Logout Successful.",
      });
    } catch (error) {
      return res.status(500).json({
        message: "Internal Server Error",
        error,
      });
    }
  },

  changePassword: async (req, res) => {
    const { currentPassword, newPassword } = req.body;
    const {
      loggedInUserData: { user },
    } = req;

    try {
      const { password, _id } = await Credential.findOne({ userId: user._id });
      const checkPassword = await bcrypt.compare(currentPassword, password);
      if (!checkPassword) {
        return res.status(400).json({
          message: "Current password you entered is incorrect.",
        });
      }

      const encryptedPassword = await bcrypt.hash(newPassword, 10);
      const upadetPassword = await Credential.findByIdAndUpdate(
        _id,
        {
          password: encryptedPassword,
        },
        { new: true }
      );
      if (!upadetPassword) {
        return res.status(404).json({
          message: "User Not Found",
        });
      }

      return res.status(200).json({
        message: "Password changed successful.",
      });
    } catch (error) {
      return res.status(500).json({
        message: "Internal Server Error",
        error,
      });
    }
  },

  forgotPassword: async (req, res) => {
    const { email } = req.body;

    try {
      // Find user is exist or not
      const user = await User.findOne({ email });
      if (!user) {
        return res.status(404).json({
          message: "Email id not registered.",
        });
      }

      const tokenObj = {
        _id: user._id,
        fullName: user.fullName,
        email: user.email,
      };
      const expireTime = 1 * 60 * 60;
      const jwtToken = jwt.sign(tokenObj, process.env.JWT_SECRET_KEY, {
        expiresIn: expireTime,
      });
      console.log("jwtToken: ", jwtToken);

      await Credential.findOneAndUpdate(
        {
          userId: user._id,
        },
        {
          forgotPasswordKey: true,
        }
      );

      const transporter = nodemailer.createTransport({
        service: "gmail",
        host: "smtp.gmail.email",
        port: 465,
        secure: true,
        auth: {
          user: process.env.GOOGLE_USERID,
          pass: process.env.GOOGLE_PASSWORD,
        },
      });

      await transporter.sendMail({
        from: '"QuizWiz Team" <quizwiz@gmail.com>',
        to: user.email,
        subject: "Reset your quizwiz account password",
        html: `
                <div style="font-family: Arial, sans-serif;">
                    <div class="email-container" style="max-width: 600px; border: 1px solid #2D3250; background-color: #EEEEEE; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                        <div class="header" style="text-align: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="1131" style="max-width: 150px; margin-top: 10px;" height="397" viewBox="0 0 1131 397" fill="none">
                                <path d="M518.4 346.6C507.783 346.6 499.15 344.325 492.5 339.775C485.85 335.225 480.833 330.267 477.45 324.9C475.7 326.183 473.075 327.292 469.575 328.225C466.192 329.275 462.633 329.8 458.9 329.8C448.167 329.8 439.183 327.35 431.95 322.45C424.717 317.55 419.292 310.9 415.675 302.5C412.058 294.1 410.25 284.65 410.25 274.15V122.6C410.25 112.1 412.233 102.65 416.2 94.25C420.283 85.85 426.117 79.2 433.7 74.3C441.283 69.4 450.267 66.95 460.65 66.95C471.15 66.95 480.133 69.4 487.6 74.3C495.183 79.2 500.958 85.85 504.925 94.25C509.008 102.65 511.05 112.1 511.05 122.6V274.15C511.05 281.033 510.117 287.392 508.25 293.225C506.5 298.942 504.458 303.2 502.125 306C503.642 308.45 505.8 310.375 508.6 311.775C511.4 313.175 514.667 314.05 518.4 314.4V346.6ZM460.65 293.05C465.317 293.05 468.583 291.183 470.45 287.45C472.317 283.6 473.25 279.167 473.25 274.15V122.6C473.25 117.817 472.317 113.5 470.45 109.65C468.583 105.683 465.317 103.7 460.65 103.7C456.1 103.7 452.833 105.683 450.85 109.65C448.983 113.5 448.05 117.817 448.05 122.6V274.15C448.05 279.167 449.042 283.6 451.025 287.45C453.008 291.183 456.217 293.05 460.65 293.05ZM558.789 329.8C552.956 329.8 548.056 327.933 544.089 324.2C540.123 320.467 537.148 315.742 535.164 310.025C533.181 304.192 532.189 298.3 532.189 292.35V135.55H567.539V285.35C567.539 288.967 568.181 291.592 569.464 293.225C570.864 294.742 573.023 295.5 575.939 295.5C578.506 295.5 580.664 294.625 582.414 292.875C584.281 291.008 585.973 288.85 587.489 286.4V135.55H622.839V327H587.489V310.9C583.289 314.867 578.564 319.008 573.314 323.325C568.064 327.642 563.223 329.8 558.789 329.8ZM641.947 327V135.55H677.297V327H641.947ZM641.947 105.1V69.75H677.297V105.1H641.947ZM696.594 327V298.3L745.244 167.75H704.294V135.55H782.694V164.25L734.044 294.8H782.694V327H696.594ZM831.308 327L796.658 69.75H831.658L846.708 203.45L847.408 211.85H850.208L851.258 203.45L867.358 69.75H894.658L910.758 203.45L911.808 211.85H914.608L915.308 203.45L930.358 69.75H965.358L930.708 327H901.308L883.808 205.2L881.708 190.15H880.308L878.208 205.2L860.708 327H831.308ZM981.01 327V135.55H1016.36V327H981.01ZM981.01 105.1V69.75H1016.36V105.1H981.01ZM1035.66 327V298.3L1084.31 167.75H1043.36V135.55H1121.76V164.25L1073.11 294.8H1121.76V327H1035.66Z" fill="#222831"/>
                                <path d="M156.433 35.0167C138.117 47.15 131.817 49.3667 119.45 47.9667C114.55 47.5 106.033 47.0334 100.55 47.0334C91.3333 46.9167 90.2833 47.15 86.3167 50.1833C81.65 53.6833 78.3833 59.2834 74.8833 69.6667C69.9833 83.7834 59.6 93.9333 45.0167 98.95C25.65 105.483 19.1167 115.633 22.5 134.3C25.65 151.683 23.3167 162.067 13.1667 175.833C-3.05001 197.883 -3.28335 199.983 9.19999 215.5C23.2 232.767 26.1167 242.45 23.0833 260.3C22.0333 266.017 21.5667 272.433 22.0333 274.883C24.0167 285.5 31.0167 293.2 42.1 296.583C60.5333 302.3 69.05 310.817 75 329.25C77.1 335.667 78.85 338.583 83.1667 342.9C90.6333 350.133 97.75 351.883 109.183 349.2C119.8 346.75 126.917 346.867 134.967 349.667C142.783 352.35 148.267 355.5 154.8 360.983C161.1 366.233 170.317 370.667 174.983 370.667C180.35 370.667 186.533 367.283 195.4 359.583C206.483 349.9 211.267 347.917 223.167 348.033C228.65 348.15 237.283 348.5 242.417 348.967C249.767 349.667 252.683 349.433 256.067 348.033C263.65 344.767 268.2 339.75 271.583 330.883C278.117 313.967 288.617 303 303.317 297.75C306.467 296.583 310.317 295.183 312.067 294.6C316.5 292.967 323.15 285.85 324.783 281.067C325.717 278.15 325.833 273.6 325.133 265.783C322.917 240.7 324.783 232.883 335.517 220.283C343.217 211.3 346.25 204.65 346.133 196.833C346.133 189.017 344.033 184.933 335.75 175.833C332.367 172.1 328.75 167.433 327.7 165.567C324.9 160.083 323.617 149.117 324.667 140.133C325.25 135.7 325.717 128.817 325.833 124.733C325.833 112.6 320.233 104.667 308.683 100.583C285.933 92.4167 278.35 84.8333 270.417 62.2C267.733 54.85 260.967 48.0833 254.433 46.2167C250.35 45.1667 247.2 45.2834 236.933 46.9167C226.317 48.6667 223.4 48.7834 217.1 47.5C207.767 45.75 202.05 42.7167 194.7 35.95C185.367 27.3167 181.983 25.3333 176.267 25.3333C171.833 25.3333 169.267 26.6167 156.433 35.0167ZM210.333 89.5C210.333 90.0833 210.1 90.6667 209.867 90.6667C209.517 90.6667 208.933 90.0833 208.583 89.5C208.233 88.8 208.467 88.3333 209.05 88.3333C209.75 88.3333 210.333 88.8 210.333 89.5ZM168.917 94.05C169.85 95.6833 167.517 96.7333 164.717 95.9167C162.733 95.2167 162.5 94.8667 163.783 94.05C165.883 92.7667 167.983 92.7667 168.917 94.05ZM162.5 103.033C162.5 105.25 159.7 108.283 158.3 107.7C157.25 107.35 156.9 107.583 157.25 108.167C157.717 108.867 154.333 109.333 148.15 109.333C139.633 109.333 138.35 109.1 138.35 107.233C138.233 103.15 140.217 102.45 151.533 102.45C157.6 102.45 162.5 102.683 162.5 103.033ZM212.433 104.317C213.133 105.483 213.6 111.317 213.717 117.383C213.833 126.483 213.6 128.583 211.85 129.867C209.867 131.383 209.867 131.5 211.733 130.8C213.6 130.1 213.833 131.617 213.717 149.117C213.717 161.25 214.183 168.367 215 168.6C216.517 169.183 216.517 173.15 215 174.083C214.417 174.433 213.833 178.283 213.833 182.6C213.717 187.267 213.133 191.233 212.2 192.4C210.567 194.5 208.467 195.317 209.75 193.45C210.1 192.867 208.817 193.1 206.833 194.033C202.517 196.25 185.483 195.2 182.8 192.517C180.7 190.3 180.467 178.167 182.683 178.05C183.85 178.05 183.85 177.817 182.683 177.35C181.633 177 181.167 173.733 181.167 166.733C181.167 160.783 180.7 157.167 180.117 158.1C179.417 159.383 179.067 159.15 178.6 157.4C177.783 154.717 180.583 148.883 181.4 151.45C181.75 152.383 181.867 152.033 181.633 150.75C181.4 149.467 181.167 144.683 181.05 140.25L180.933 132.083L180 138.383C178.95 145.15 176.033 149.583 174.283 146.9C173.7 145.85 173 147.367 172.533 151.217C171.833 156.467 171.483 157.167 168.917 157.167C167.283 157.167 165.183 155.883 163.783 154.133L161.333 150.983L161.217 157.283C161.1 163.117 160.983 163.35 160.05 159.85C159.35 157.4 159.467 155.067 160.283 152.85C162.033 148.65 161.567 142.817 159.35 141.65C157.95 140.717 157.95 140.367 159.583 138.383C161.333 136.633 161.45 135.117 160.633 128.35C159.583 120.417 159.583 120.417 155.733 120.067L151.767 119.717L152.117 125.317C152.233 128.467 152 131.733 151.417 132.55C150.95 133.483 150.6 139.317 150.717 145.733C150.833 154.717 151.3 157.75 152.7 159.15C154.333 160.9 154.45 161.25 152.817 162.417C150.717 163.933 150.483 165.45 150.717 177.117C150.833 185.05 151.067 186.1 153.167 186.683C154.45 187.033 155.5 187.967 155.5 188.667C155.5 189.483 154.567 189.833 153.167 189.483C151.3 189.017 150.833 189.483 150.833 191.7C150.833 194.267 151.3 194.5 156.083 194.5H161.333L161.45 190.067C161.45 187.733 161.45 180.85 161.333 174.9C161.1 163.233 160.867 163.7 168.683 162.533C173 161.95 173 162.067 173 166.033C173 170.117 172.067 170.933 169.85 168.717C168.333 167.2 165.65 168.367 166.583 170.117C167.05 170.7 168.567 171.167 170.2 171.167H173.117L172.767 183.417C172.417 194.85 173.117 198.7 174.517 193.333C175.333 190.067 177.083 190.417 178.717 194.15C179.883 196.717 179.767 197.883 178.017 201.15C175.567 205.7 174.75 205.933 172.883 202.55C171.95 200.8 171.25 200.45 170.317 201.383C169.617 202.083 167.167 202.667 164.833 202.667C161.217 202.667 160.517 203.133 159.233 206.4C157.833 210.017 157.6 210.133 156.083 208.15C155.267 206.867 154.8 205.233 155.15 204.3C155.967 202.2 148.967 201.967 148.15 204.067C147.683 205.233 147.217 205.233 146.517 204.3C146.05 203.483 144.533 202.783 143.25 202.55C141.033 202.083 140.917 201.033 140.567 185.983C140.45 176.883 140.683 170 141.383 170C143.133 170 143.6 165.8 141.967 163.7C140.683 161.833 140.45 161.95 139.983 164.983C139.75 166.733 139.633 165.567 139.867 162.417C140.1 159.15 140.333 146.783 140.333 134.883V113.183L143.25 111.9C147.333 110.033 167.283 110.033 169.733 111.9C171.25 113.067 171.833 116.1 172.183 124.85C172.533 131.15 173.117 136.633 173.467 136.983C173.817 137.45 174.167 136.633 174.167 135.233C174.167 132.2 177.433 128.817 179.533 129.633C180.817 130.1 181.167 127.883 181.167 117.85C181.167 107.583 181.517 105.25 183.15 104.083C184.433 103.15 189.917 102.567 198.317 102.45C209.75 102.217 211.5 102.45 212.433 104.317ZM218.5 114.117C218.5 114.7 217.683 115.167 216.75 115.167C215.817 115.167 215 114.35 215 113.417C215 112.367 215.7 112.017 216.75 112.367C217.683 112.833 218.5 113.533 218.5 114.117ZM133.333 121C133.333 121.583 132.75 122.167 132.05 122.167C131.467 122.167 131.233 121.583 131.583 121C131.933 120.3 132.517 119.833 132.867 119.833C133.1 119.833 133.333 120.3 133.333 121ZM106.5 123.45C106.5 124.033 106.033 124.5 105.333 124.5C104.75 124.5 104.167 123.683 104.167 122.633C104.167 121.7 104.75 121.233 105.333 121.583C106.033 121.933 106.5 122.75 106.5 123.45ZM238.683 123.8C239.383 125.55 238.567 126.833 236.933 126.833C236.467 126.833 236 125.783 236 124.5C236 121.817 237.75 121.35 238.683 123.8ZM139.167 126.25C139.167 127.183 138.7 128 138 128C137.417 128 136.833 127.183 136.833 126.25C136.833 125.317 137.417 124.5 138 124.5C138.7 124.5 139.167 125.317 139.167 126.25ZM229.233 131.733C227.483 133.483 226.2 132.2 227.133 129.633C227.717 128.117 228.183 127.883 229.233 128.933C230.283 129.983 230.283 130.683 229.233 131.733ZM219.083 133.833C218.733 134.417 217.917 135 217.217 135C216.633 135 216.167 134.417 216.167 133.833C216.167 133.133 216.983 132.667 218.033 132.667C218.967 132.667 219.433 133.133 219.083 133.833ZM250.583 142C250.233 142.583 249.417 143.167 248.717 143.167C248.133 143.167 247.667 142.583 247.667 142C247.667 141.3 248.483 140.833 249.533 140.833C250.467 140.833 250.933 141.3 250.583 142ZM107.667 143.167C107.667 143.75 107.083 144.333 106.383 144.333C105.8 144.333 105.567 143.75 105.917 143.167C106.267 142.467 106.85 142 107.2 142C107.433 142 107.667 142.467 107.667 143.167ZM138.817 152.033C137.767 153.083 135.55 151.333 136.367 149.933C136.833 149.233 137.533 149.233 138.35 150.05C139.05 150.75 139.283 151.567 138.817 152.033ZM223.167 154.367C223.167 155.417 222.583 156 221.767 155.767C219.667 155.067 219.317 152.5 221.3 152.5C222.35 152.5 223.167 153.317 223.167 154.367ZM68.8167 159.733C68.4667 160.667 68.1167 160.317 68.1167 159.033C68 157.75 68.35 157.05 68.7 157.517C69.05 157.867 69.1667 158.917 68.8167 159.733ZM93.6667 161.833C93.6667 162.417 93.4333 163 93.2 163C92.85 163 92.2667 162.417 91.9167 161.833C91.5667 161.133 91.8 160.667 92.3833 160.667C93.0833 160.667 93.6667 161.133 93.6667 161.833ZM113.267 163.233C112.567 165.333 110 165.683 110 163.7C110 162.65 110.817 161.833 111.867 161.833C112.917 161.833 113.5 162.417 113.267 163.233ZM253.5 164.167C253.5 164.75 253.267 165.333 253.033 165.333C252.683 165.333 252.1 164.75 251.75 164.167C251.4 163.467 251.633 163 252.217 163C252.917 163 253.5 163.467 253.5 164.167ZM85.0333 169.533C84.45 171.05 83.8667 171.167 82.9333 170.233C82.2333 169.533 82 168.133 82.4667 166.967C83.05 165.45 83.6333 165.333 84.5667 166.267C85.2667 166.967 85.5 168.367 85.0333 169.533ZM100.667 167.667C100.667 168.25 100.433 168.833 100.2 168.833C99.85 168.833 99.2667 168.25 98.9167 167.667C98.5667 166.967 98.8 166.5 99.3833 166.5C100.083 166.5 100.667 166.967 100.667 167.667ZM125.167 170C125.167 170.583 124.7 171.167 124 171.167C123.417 171.167 122.833 170.583 122.833 170C122.833 169.3 123.417 168.833 124 168.833C124.7 168.833 125.167 169.3 125.167 170ZM92.85 171.4C93.2 172.8 91.6833 179.1 90.5167 180.383C90.2833 180.733 89.4667 179.917 88.5333 178.633C87.1333 176.767 87.1333 175.95 88.5333 173.267C90.4 169.767 92.0333 169.067 92.85 171.4ZM111.75 171.167C112.1 171.75 111.867 172.333 111.283 172.333C110.583 172.333 110 171.75 110 171.167C110 170.467 110.233 170 110.467 170C110.817 170 111.4 170.467 111.75 171.167ZM225.5 173.5C225.5 174.083 225.033 174.667 224.333 174.667C223.75 174.667 223.167 174.083 223.167 173.5C223.167 172.8 223.75 172.333 224.333 172.333C225.033 172.333 225.5 172.8 225.5 173.5ZM82.4667 175.95C82.1167 176.533 81.3 176.767 80.7167 176.3C80.1333 175.95 79.9 175.133 80.3667 174.55C80.7167 173.967 81.5333 173.733 82.1167 174.2C82.7 174.55 82.9333 175.367 82.4667 175.95ZM176.5 174.667C176.5 175.25 176.033 175.833 175.333 175.833C174.75 175.833 174.167 175.25 174.167 174.667C174.167 173.967 174.75 173.5 175.333 173.5C176.033 173.5 176.5 173.967 176.5 174.667ZM123.417 180.5C123.767 181.083 123.533 181.667 122.95 181.667C122.25 181.667 121.667 181.083 121.667 180.5C121.667 179.8 121.9 179.333 122.133 179.333C122.483 179.333 123.067 179.8 123.417 180.5ZM156.083 181.667C156.433 182.25 156.2 182.833 155.617 182.833C154.917 182.833 154.333 182.25 154.333 181.667C154.333 180.967 154.567 180.5 154.8 180.5C155.15 180.5 155.733 180.967 156.083 181.667ZM82.9333 186.1C83.1667 186.917 82.5833 187.5 81.5333 187.5C80.4833 187.5 79.6667 186.683 79.6667 185.633C79.6667 183.65 82.2333 184 82.9333 186.1ZM246.5 185.167C246.5 185.75 245.917 186.333 245.217 186.333C244.633 186.333 244.4 185.75 244.75 185.167C245.1 184.467 245.683 184 246.033 184C246.267 184 246.5 184.467 246.5 185.167ZM104.633 188.783C104.283 189.367 103.467 189.6 102.883 189.133C102.3 188.783 102.067 187.967 102.533 187.383C102.883 186.8 103.7 186.567 104.283 187.033C104.867 187.383 105.1 188.2 104.633 188.783ZM136.717 187.85C137.417 188.783 137.65 189.833 137.183 190.183C136.367 191.117 133.333 188.9 133.333 187.383C133.333 185.867 135.2 186.1 136.717 187.85ZM94.8333 192.167C94.8333 192.75 94.3667 193.333 93.6667 193.333C93.0833 193.333 92.5 192.75 92.5 192.167C92.5 191.467 93.0833 191 93.6667 191C94.3667 191 94.8333 191.467 94.8333 192.167ZM260.5 194.5C260.5 195.083 260.033 195.667 259.333 195.667C258.75 195.667 258.167 195.083 258.167 194.5C258.167 193.8 258.75 193.333 259.333 193.333C260.033 193.333 260.5 193.8 260.5 194.5ZM85.5 195.667C85.5 196.25 84.9167 196.833 84.2167 196.833C83.6333 196.833 83.4 196.25 83.75 195.667C84.1 194.967 84.6833 194.5 85.0333 194.5C85.2667 194.5 85.5 194.967 85.5 195.667ZM218.617 196.25C218.5 196.833 217.8 197.417 217.1 197.417C216.283 197.417 215.35 198.467 215 199.75C214.417 201.85 213.25 202.083 203.333 202.317C196.567 202.433 192.133 203.133 191.55 203.95C191.083 204.65 190.15 204.883 189.45 204.533C188.517 203.95 189.217 202.55 191.317 200.217C194.35 197.067 195.05 196.833 204.15 196.833C209.633 196.833 214.067 196.25 214.417 195.55C215.35 194.15 218.617 194.617 218.617 196.25ZM93.6667 199.867C93.6667 200.8 93.2 201.267 92.5 200.917C91.9167 200.567 91.3333 199.75 91.3333 199.05C91.3333 198.467 91.9167 198 92.5 198C93.2 198 93.6667 198.817 93.6667 199.867ZM126.333 200.333C126.333 200.917 125.867 201.5 125.167 201.5C124.583 201.5 124 200.917 124 200.333C124 199.633 124.583 199.167 125.167 199.167C125.867 199.167 126.333 199.633 126.333 200.333ZM117.583 203.833C117.933 204.417 117.7 205 117.117 205C116.417 205 115.833 204.417 115.833 203.833C115.833 203.133 116.067 202.667 116.3 202.667C116.65 202.667 117.233 203.133 117.583 203.833ZM240.667 203.133C240.667 203.483 240.2 204.067 239.5 204.417C238.917 204.767 238.333 204.533 238.333 203.95C238.333 203.25 238.917 202.667 239.5 202.667C240.2 202.667 240.667 202.9 240.667 203.133ZM231.333 206.633C231.333 207.567 230.867 208.733 230.167 209.083C229.583 209.433 229 208.733 229 207.45C229 206.05 229.583 205 230.167 205C230.867 205 231.333 205.7 231.333 206.633ZM198.667 206.633C198.667 206.983 198.2 207.567 197.5 207.917C196.917 208.267 196.333 208.033 196.333 207.45C196.333 206.75 196.917 206.167 197.5 206.167C198.2 206.167 198.667 206.4 198.667 206.633ZM139.867 211.65C138.7 212.817 137.65 211.067 138.7 209.55C139.4 208.267 139.633 208.267 140.1 209.55C140.333 210.367 140.217 211.3 139.867 211.65ZM175.333 208.967C175.333 210.25 173.117 210.717 172.417 209.667C172.067 209.083 172.533 208.5 173.467 208.5C174.517 208.5 175.333 208.733 175.333 208.967ZM222 210.833C222 211.417 221.533 212 220.833 212C220.25 212 219.667 211.417 219.667 210.833C219.667 210.133 220.25 209.667 220.833 209.667C221.533 209.667 222 210.133 222 210.833ZM99.5 212C99.5 212.583 98.6833 213.167 97.75 213.167C96.8167 213.167 96 212.583 96 212C96 211.3 96.8167 210.833 97.75 210.833C98.6833 210.833 99.5 211.3 99.5 212ZM179.417 212C179.767 212.583 179.3 213.167 178.367 213.167C177.317 213.167 176.5 212.583 176.5 212C176.5 211.3 176.967 210.833 177.55 210.833C178.25 210.833 179.067 211.3 179.417 212ZM195.167 213.167C195.167 216.083 192.717 221.333 191.433 221.333C190.5 221.333 191.317 213.75 192.483 211.65C193.417 210.017 195.167 210.833 195.167 213.167ZM89 216.667C89 217.25 88.4167 217.833 87.7167 217.833C87.1333 217.833 86.9 217.25 87.25 216.667C87.6 215.967 88.1833 215.5 88.5333 215.5C88.7667 215.5 89 215.967 89 216.667ZM170.2 218.65C169.033 219.817 167.983 218.067 169.033 216.55C169.733 215.267 169.967 215.267 170.433 216.55C170.667 217.367 170.55 218.3 170.2 218.65ZM139.167 217.133C139.167 217.483 138.7 218.067 138 218.417C137.417 218.767 136.833 218.533 136.833 217.95C136.833 217.25 137.417 216.667 138 216.667C138.7 216.667 139.167 216.9 139.167 217.133ZM155.5 218.417C155.5 219.467 154.683 221.917 153.633 223.9C152.35 226.467 151.417 227.05 150.483 226.117C149.55 225.183 149.783 223.783 151.183 220.75C153.167 216.55 155.5 215.267 155.5 218.417ZM203.333 217.833C203.333 218.417 202.75 219 202.05 219C201.467 219 201.233 218.417 201.583 217.833C201.933 217.133 202.517 216.667 202.867 216.667C203.1 216.667 203.333 217.133 203.333 217.833ZM161.333 219.583C161.333 220.517 160.867 221.333 160.167 221.333C159.583 221.333 159 220.517 159 219.583C159 218.65 159.583 217.833 160.167 217.833C160.867 217.833 161.333 218.65 161.333 219.583ZM79.0833 220.167C79.4333 220.75 79.2 221.333 78.6167 221.333C77.9167 221.333 77.3333 220.75 77.3333 220.167C77.3333 219.467 77.5667 219 77.8 219C78.15 219 78.7333 219.467 79.0833 220.167ZM97.75 221.333C98.1 221.917 97.6333 222.5 96.7 222.5C95.65 222.5 94.8333 221.917 94.8333 221.333C94.8333 220.633 95.3 220.167 95.8833 220.167C96.5833 220.167 97.4 220.633 97.75 221.333ZM120.5 224.833C120.5 225.417 120.267 226 120.033 226C119.683 226 119.1 225.417 118.75 224.833C118.4 224.133 118.633 223.667 119.217 223.667C119.917 223.667 120.5 224.133 120.5 224.833ZM185.833 224.133C185.833 224.483 185.367 225.067 184.667 225.417C184.083 225.767 183.5 225.533 183.5 224.95C183.5 224.25 184.083 223.667 184.667 223.667C185.367 223.667 185.833 223.9 185.833 224.133ZM139.75 226C140.1 226.583 139.4 227.167 138.117 227.167C136.717 227.167 135.667 226.583 135.667 226C135.667 225.3 136.367 224.833 137.3 224.833C138.233 224.833 139.4 225.3 139.75 226ZM203.1 226.233C202.4 228.333 199.833 228.683 199.833 226.7C199.833 225.65 200.65 224.833 201.7 224.833C202.75 224.833 203.333 225.417 203.1 226.233ZM235.65 227.867C234.6 228.917 232.383 227.167 233.2 225.767C233.667 225.067 234.367 225.067 235.183 225.883C235.883 226.583 236.117 227.4 235.65 227.867ZM159.583 228.333C159.933 228.917 159.7 229.5 159.117 229.5C158.417 229.5 157.833 228.917 157.833 228.333C157.833 227.633 158.067 227.167 158.3 227.167C158.65 227.167 159.233 227.633 159.583 228.333ZM151.3 231.717C152.233 233.233 150.833 236.617 149.55 235.8C148.15 234.983 148.15 230.667 149.55 230.667C150.25 230.667 150.95 231.133 151.3 231.717ZM134.5 233C134.5 233.583 134.033 234.167 133.333 234.167C132.75 234.167 132.167 233.583 132.167 233C132.167 232.3 132.75 231.833 133.333 231.833C134.033 231.833 134.5 232.3 134.5 233ZM173 235.917C173 236.85 172.533 237.667 171.833 237.667C171.25 237.667 170.667 236.85 170.667 235.917C170.667 234.983 171.25 234.167 171.833 234.167C172.533 234.167 173 234.983 173 235.917ZM190.5 236.5C190.5 237.083 190.267 237.667 190.033 237.667C189.683 237.667 189.1 237.083 188.75 236.5C188.4 235.8 188.633 235.333 189.217 235.333C189.917 235.333 190.5 235.8 190.5 236.5ZM206.367 238.483C205.2 239.65 204.15 237.9 205.2 236.383C205.9 235.1 206.133 235.1 206.6 236.383C206.833 237.2 206.717 238.133 206.367 238.483ZM90.75 237.667C91.1 238.25 90.8667 238.833 90.2833 238.833C89.5833 238.833 89 238.25 89 237.667C89 236.967 89.2333 236.5 89.4667 236.5C89.8167 236.5 90.4 236.967 90.75 237.667ZM82.5833 240C82.9333 240.583 82.7 241.167 82.1167 241.167C81.4167 241.167 80.8333 240.583 80.8333 240C80.8333 239.3 81.0667 238.833 81.3 238.833C81.65 238.833 82.2333 239.3 82.5833 240ZM133.1 241.4C132.4 243.5 129.833 243.85 129.833 241.867C129.833 240.817 130.65 240 131.7 240C132.75 240 133.333 240.583 133.1 241.4ZM125.05 244.2C127.033 244.667 128.667 245.717 128.667 246.533C128.667 248.867 131.35 248.05 132.4 245.483C132.983 244.083 134.267 243.5 135.9 243.733C138.467 244.083 138.583 244.55 138.933 256.8C139.167 266.25 138.817 269.75 137.767 270.45C136.6 271.267 136.6 271.733 137.767 272.9C138.583 273.717 139.167 277.45 139.167 282.233C139.167 289.467 139.4 290.167 141.5 290.167C143.833 290.167 143.95 289.583 143.717 270.917C143.6 256.917 143.95 251.2 145 249.917C145.817 248.867 146.167 247.7 145.7 247.35C145.233 246.883 144.417 247.233 143.833 248.167C142.317 250.5 142.433 248.517 143.833 245.717C145.583 242.567 149.667 242.8 149.783 246.067C149.783 247.583 150.133 256.567 150.367 266.133C150.6 275.7 150.95 283.633 151.183 283.867C151.3 284.1 152.117 283.867 152.817 283.4C153.867 282.817 154.333 276.633 154.333 262.983L154.567 243.5H157.367H160.167V269.75V296H157.25C155.267 296 154.333 295.3 154.333 293.9C154.217 292.15 154.1 292.15 152.817 293.667C151.183 295.65 136.483 296.117 134.617 294.25C134.033 293.55 133.333 283.983 132.983 272.9C132.633 255.75 132.283 252.367 130.533 250.733C128.55 248.867 128.55 249.45 128.9 262.983C129.133 270.683 128.9 276.633 128.55 275.933C128.2 275.35 128.083 279.317 128.317 284.8C128.783 293.9 128.667 294.833 126.683 294.95C124.933 294.95 125.05 295.183 127.267 296C130.767 297.517 130.533 298.683 126.217 300.317C121.783 302.067 116.417 300.433 117.467 297.75C117.933 296.467 117.35 296 115.483 296C111.983 296 108.017 293.2 109.767 292.033C110.583 291.567 111.167 289.7 111.167 287.833C111.167 285.267 110.7 284.567 109.417 285.033C108.483 285.5 107.667 285.15 107.667 284.45C107.667 283.75 108.483 283.167 109.417 283.167C110.817 283.167 111.05 280.833 110.583 268.233C110 248.4 110.583 244.9 114.55 244.317C119.917 243.5 121.317 243.5 125.05 244.2ZM220.717 269.867L220.833 296.117L217.683 295.767L214.417 295.417V272.667C214.417 244.433 214.417 244.083 217.917 243.733L220.6 243.5L220.717 269.867ZM171.017 245.367C171.95 246.417 169.733 250.5 168.333 250.5C167.633 250.5 167.167 249.217 167.167 247.583C167.167 244.9 169.267 243.617 171.017 245.367ZM182.333 246.067C182.333 246.883 180 256.567 177.083 267.65C174.167 278.733 171.833 288.3 171.833 289.117C171.833 290.05 173.467 290.167 177.083 289.7C181.983 288.883 182.333 289 182.217 291.567C182.1 293.083 182.45 295.183 182.917 296.233C183.383 297.517 183.267 298.333 182.45 298.333C181.633 298.333 180.817 297.517 180.35 296.467C179.767 294.95 178.367 294.717 171.717 295.3C163.433 296.117 161.1 295.067 163.783 291.8C164.483 290.867 165.3 289 165.417 287.483C165.65 286.083 166.583 282.583 167.517 279.667C168.45 276.75 170.433 269.633 171.833 263.917C173.233 258.083 174.633 252.483 174.867 251.317C175.333 250.15 174.867 249.333 173.817 249.333C172.65 249.333 172.3 248.517 172.65 247C173.117 245.133 174.283 244.667 177.783 244.667C180.583 244.667 182.333 245.25 182.333 246.067ZM190.5 267.067L190.617 289.583L192.95 286.783C195.05 284.217 195.283 282.35 195.167 266.95C195.05 257.617 195.05 248.75 195.167 247.233C195.167 245.25 195.867 244.667 198.083 244.667H201L201.233 267.067C201.467 285.383 201.817 289.117 202.983 287.133C203.8 285.733 204.5 279.9 204.617 274.067C204.733 264.85 205.083 263.567 206.717 264.267C208.233 264.85 208.233 264.617 206.483 262.75C205.083 261.35 204.5 259.483 204.733 257.267C205.083 254.817 204.733 254 203.45 254C201.933 254 201.933 253.767 203.217 252.95C204.267 252.25 204.5 250.85 203.917 248.283C203.217 244.783 203.217 244.667 207.417 244.667H211.617L211.383 258.317C211.267 271.15 209.983 284.567 208.467 289.35C207.767 291.45 202.75 294.483 197.267 296.117C194.467 296.817 194 296.7 194 294.717C194 291.917 193.3 291.917 189.567 294.833C187.817 296.233 186.183 296.817 185.6 296.233C185.017 295.65 184.55 287.95 184.55 279.083C184.667 269.517 184.2 262.4 183.383 261.467C182.567 260.533 182.567 259.833 183.5 259.25C184.083 258.9 184.667 255.4 184.667 251.55C184.667 245.017 184.783 244.667 187.583 244.667H190.5V267.067ZM243 245.483C243 246.417 233.317 282.933 231.8 287.717C230.983 290.517 230.983 290.517 236.933 289.7C241.483 289.117 243 289.233 243 290.4C243 293.667 240.9 294.6 232.85 295.417C224.45 296.117 221.767 295.183 224.1 292.15C224.683 291.333 225.5 289.467 225.85 287.833C226.2 286.2 227.133 282.583 227.95 279.667C228.65 276.75 229.35 273.6 229.467 272.667C229.583 271.617 230.05 270.217 230.633 269.4C231.1 268.583 231.567 266.367 231.567 264.5C231.683 262.517 232.033 261 232.5 261C232.967 261 233.667 259.25 233.9 257.15C234.25 255.167 234.833 252.483 235.417 251.317C236 249.917 235.767 249.333 234.367 249.333C233.317 249.333 232.5 248.75 232.5 248.167C232.5 247.467 232.033 247 231.333 247C230.75 247 230.167 247.817 230.167 248.75C230.167 249.683 229.7 250.5 229 250.5C228.417 250.5 227.833 249.217 227.833 247.583C227.833 244.783 228.067 244.667 235.417 244.667C239.617 244.667 243 245.017 243 245.483ZM164.25 249.333C164.6 249.917 164.133 250.5 163.2 250.5C162.15 250.5 161.333 249.917 161.333 249.333C161.333 248.633 161.8 248.167 162.383 248.167C163.083 248.167 163.9 248.633 164.25 249.333ZM103.933 253.067C103.233 255.167 100.667 255.517 100.667 253.533C100.667 252.483 101.483 251.667 102.533 251.667C103.583 251.667 104.167 252.25 103.933 253.067ZM226.667 255.283C225.85 256.567 225.033 257.383 224.683 257.033C223.75 256.1 225.267 252.833 226.667 252.833C227.483 252.833 227.483 253.533 226.667 255.283ZM168.333 261.467C168.333 262.4 167.867 263.45 167.283 263.917C165.883 264.733 164.483 262.517 165.417 261C166.467 259.25 168.333 259.6 168.333 261.467ZM107.667 264.5C107.667 265.083 107.2 265.667 106.5 265.667C105.917 265.667 105.333 265.083 105.333 264.5C105.333 263.8 105.917 263.333 106.5 263.333C107.2 263.333 107.667 263.8 107.667 264.5ZM167.167 269.75C167.167 270.683 166.7 271.5 166.117 271.5C164.6 271.5 163.55 269.633 164.483 268.7C165.767 267.417 167.167 268 167.167 269.75ZM192.6 299.617C192.133 302.883 189.333 304.05 189.333 300.9C189.333 299.617 189.683 297.633 190.033 296.583C191.083 293.9 193.183 296.233 192.6 299.617ZM142.083 301.833C142.433 302.417 142.2 303 141.617 303C140.917 303 140.333 302.417 140.333 301.833C140.333 301.133 140.567 300.667 140.8 300.667C141.15 300.667 141.733 301.133 142.083 301.833ZM126.333 319.333C126.333 319.917 125.867 320.5 125.167 320.5C124.583 320.5 124 319.917 124 319.333C124 318.633 124.583 318.167 125.167 318.167C125.867 318.167 126.333 318.633 126.333 319.333Z" fill="#222831"/>
                                <path d="M191.783 114C191.2 115.983 190.967 117.267 191.55 117.033C192.017 116.683 192.483 123.917 192.483 133.017C192.6 175.017 192.717 182.95 193.533 184.233C193.883 184.7 195.633 185.167 197.617 185.167C200.067 185.167 201 184.583 201.117 183.067C201.233 182.017 201.467 178.983 201.7 176.417C201.933 173.85 202.167 158.45 202.167 142.117C202.167 110.267 202.283 110.5 196.1 110.5C193.767 110.5 192.833 111.317 191.783 114ZM198.667 121.583C198.667 124.033 196.1 129.167 194.817 129.167C193.767 129.167 194.7 121.583 195.983 119.483C196.8 118.2 198.667 119.717 198.667 121.583ZM198.667 175.833C198.667 176.417 198.083 177 197.383 177C196.8 177 196.567 176.417 196.917 175.833C197.267 175.133 197.85 174.667 198.2 174.667C198.433 174.667 198.667 175.133 198.667 175.833Z" fill="#222831"/>
                                <path d="M206.25 121C206.6 121.583 207.183 122.167 207.533 122.167C207.767 122.167 208 121.583 208 121C208 120.3 207.417 119.833 206.717 119.833C206.133 119.833 205.9 120.3 206.25 121Z" fill="#222831"/>
                                <path d="M167.167 124.617C167.167 125.2 167.75 125.433 168.333 125.083C169.033 124.733 169.5 124.15 169.5 123.8C169.5 123.567 169.033 123.333 168.333 123.333C167.75 123.333 167.167 123.917 167.167 124.617Z" fill="#222831"/>
                                <path d="M208.583 138.5C208.933 139.083 209.517 139.667 209.867 139.667C210.1 139.667 210.333 139.083 210.333 138.5C210.333 137.8 209.75 137.333 209.05 137.333C208.467 137.333 208.233 137.8 208.583 138.5Z" fill="#222831"/>
                                <path d="M206.25 144.333C204.967 146.55 206.833 147.833 209.167 146.433C210.8 145.383 211.033 144.8 209.983 144.1C208.117 142.933 207.067 142.933 206.25 144.333Z" fill="#222831"/>
                                <path d="M187 182.367C187 183.3 187.583 183.767 188.167 183.417C188.867 183.067 189.333 182.25 189.333 181.55C189.333 180.967 188.867 180.5 188.167 180.5C187.583 180.5 187 181.317 187 182.367Z" fill="#222831"/>
                                <path d="M167.867 193.217C165.65 197.3 165.65 198 167.167 198C167.867 198 168.333 197.067 168.333 195.9C168.333 194.733 168.917 193.217 169.733 192.4C170.433 191.7 170.783 190.767 170.433 190.3C169.967 189.95 168.8 191.233 167.867 193.217Z" fill="#222831"/>
                                <path d="M184.667 191C184.667 191.583 185.25 192.167 185.833 192.167C186.533 192.167 187 191.583 187 191C187 190.3 186.533 189.833 185.833 189.833C185.25 189.833 184.667 190.3 184.667 191Z" fill="#222831"/>
                                <path d="M143.367 192.05C142.9 192.867 142.783 193.8 143.133 194.15C144.183 195.2 145.35 193.683 144.767 192.05C144.3 190.767 144.067 190.767 143.367 192.05Z" fill="#222831"/>
                                <path d="M157.25 201.5C156.9 202.083 157.133 202.667 157.717 202.667C158.417 202.667 159 202.083 159 201.5C159 200.8 158.767 200.333 158.533 200.333C158.183 200.333 157.6 200.8 157.25 201.5Z" fill="#222831"/>
                                <path d="M117 254.467C117 257.5 116.417 259.95 115.6 260.3C114.433 260.883 114.433 261.117 115.6 261.7C116.533 262.167 117 265.2 117 271.033C117 278.15 117.35 279.433 118.75 278.967C119.917 278.5 120.5 278.967 120.5 280.25C120.5 281.533 119.917 282 118.75 281.533C117.35 281.067 117 281.883 117 285.033C117 288.767 119.45 291.567 121.2 289.817C121.55 289.467 122.133 284.1 122.483 277.8C122.717 271.5 123.067 266.133 123.067 265.783C123.067 265.317 123.067 261.583 122.95 257.15C122.833 249.567 122.717 249.333 119.917 249.333C117.233 249.333 117 249.8 117 254.467Z" fill="#222831"/>
                                <path d="M132.983 251.783C133.333 252.95 134.383 254 135.2 254C137.533 254 137.183 252.483 134.617 250.85C132.75 249.683 132.517 249.8 132.983 251.783Z" fill="#222831"/>
                                <path d="M113.5 268C113.5 268.583 114.083 269.167 114.667 269.167C115.367 269.167 115.833 268.583 115.833 268C115.833 267.3 115.367 266.833 114.667 266.833C114.083 266.833 113.5 267.3 113.5 268Z" fill="#222831"/>
                                <path d="M145 275.933C145 276.517 145.817 277.45 146.867 277.8C148.033 278.267 148.5 277.917 148.267 277.1C147.683 275.35 145 274.417 145 275.933Z" fill="#222831"/>
                                <path d="M154.45 288.533C154.45 289.817 154.8 290.167 155.15 289.233C155.5 288.417 155.383 287.367 155.033 287.017C154.683 286.55 154.333 287.25 154.45 288.533Z" fill="#222831"/>
                                <path d="M148.5 290.4C148.5 292.617 148.733 292.733 149.667 291.333C151.183 289.117 151.183 287.833 149.667 287.833C149.083 287.833 148.5 289 148.5 290.4Z" fill="#222831"/>
                                <path d="M168.333 289.467C168.333 290.517 168.917 291.333 169.5 291.333C170.2 291.333 170.667 290.867 170.667 290.283C170.667 289.583 170.2 288.767 169.5 288.417C168.917 288.067 168.333 288.533 168.333 289.467Z" fill="#222831"/>
                                <path d="M196.567 270.217C197.033 271.733 198.667 272.083 198.783 270.683C198.783 270.217 198.2 269.633 197.5 269.283C196.683 269.05 196.217 269.517 196.567 270.217Z" fill="#222831"/>
                                <path d="M185.833 283.167C185.833 283.75 186.417 284.333 187.117 284.333C187.7 284.333 187.933 283.75 187.583 283.167C187.233 282.467 186.65 282 186.3 282C186.067 282 185.833 282.467 185.833 283.167Z" fill="#222831"/>
                                <path d="M193.417 289C192.95 289.7 194 290.167 195.633 290.167C197.267 290.167 198.667 289.583 198.667 289C198.667 288.3 197.617 287.833 196.45 287.833C195.167 287.833 193.767 288.3 193.417 289Z" fill="#222831"/>
                            </svg>
                        </div>
                        <div class="content" style="padding: 10px 0 0 0;">
                            <h2 style="text-align: center; color: #333;">Password Reset Request</h2>
                            <p style="padding: 20px 10px 0 10px; font-size: 16px; line-height: 1.5; color: #333333;">Hello ${user?.fullName},</p>
                            <p style="padding: 0 10px 0 10px; font-size: 16px; line-height: 1.5; color: #333333;">You have requested to reset your password. Click the button below to set a new password for your account. This link is valid for only 1 hour. If you have questions contact support team.</p>
                        </div>
                        <div class="button-container" style="text-align: center; margin: 30px 0;">
                            <a href="https://quizwiz-by-dhru3162.vercel.app/forgot-password/${jwtToken}" target="_blank" style="background-color: #2D3250; color: #ffffff; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-size: 16px; display: inline-block;">Reset Your Password</a>
                        </div>
                        <div class="footer" style="text-align: center; font-size: 12px; color: #777777; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                            <p style="margin: 0;">If you did not request this password reset, please ignore this email or <a href="https://quizwiz-by-dhru3162.vercel.app/contact_us" style="color: #0C356A; text-decoration: none;">contact support</a>.</p>
                            <p style="margin: 0;">© 2024 Quizwiz. All rights reserved.</p>
                        </div>
                    </div>
                </div>
                `,
      });

      return res.status(200).json({
        success: true,
      });
    } catch (error) {
      return res.status(500).json({
        message: "Internal Server Error",
        error,
      });
    }
  },

  checkLink: async (req, res) => {
    const { token } = req.body;

    if (!token || token === "") {
      return res.status(400).json({
        message: "Bad Request",
      });
    }

    try {
      const decodedToken = jwt.verify(token, process.env.JWT_SECRET_KEY);

      const password = await Credential.findOne({
        userId: decodedToken._id,
      }).lean();
      if (!password?.forgotPasswordKey) {
        return res.status(401).json({
          message: "token expired",
        });
      }

      return res.status(200).json({
        success: true,
      });
    } catch (error) {
      return res.status(401).json({
        message: "token expired",
      });
    }
  },

  ResetPassword: async (req, res) => {
    const { token, newPassword } = req.body;

    try {
      const decodedToken = jwt.verify(token, process.env.JWT_SECRET_KEY);

      const encryptedPassword = await bcrypt.hash(newPassword, 10);
      const credential = await Credential.findOne({
        userId: decodedToken._id,
      }).lean();
      const checkPassword = await bcrypt.compare(
        newPassword,
        credential.password
      );
      if (checkPassword) {
        return res.status(401).json({
          message: "Password must be different from the current one",
        });
      }
      await Credential.findOneAndUpdate(
        {
          userId: decodedToken._id,
        },
        {
          forgotPasswordKey: false,
          password: encryptedPassword,
        }
      );

      return res.status(200).json({
        message: "Password changed successful.",
      });
    } catch (error) {
      return res.status(401).json({
        message: "token expired",
      });
    }
  },
};
